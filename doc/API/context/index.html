<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Pana Wang">
        <link rel="canonical" href="http://koajs.in/API/context/">
        <link rel="shortcut icon" href="../../favicon.ico">
        

        <title>Context - Koa</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/prettify-1.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Koa</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Basic <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../basics/promise">Promise</a>
                        </li>
                    
                        <li >
                            <a href="../../basics/generator">Generator</a>
                        </li>
                    
                        <li >
                            <a href="../../basics/co">Co</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../application">Application</a>
                        </li>
                    
                        <li class="active">
                            <a href=".">Context</a>
                        </li>
                    
                        <li >
                            <a href="../request">Request</a>
                        </li>
                    
                        <li >
                            <a href="../response">Response</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Middleware <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../Middleware/guide">Guide</a>
                        </li>
                    
                        <li >
                            <a href="../../Middleware/hero">Hero</a>
                        </li>
                    
                        <li >
                            <a href="../../Middleware/middlewares">Middleware List</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Misc <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../Misc/error">Error</a>
                        </li>
                    
                        <li >
                            <a href="../../Misc/example">Example</a>
                        </li>
                    
                        <li >
                            <a href="../../Misc/resource">Resource</a>
                        </li>
                    
                        <li >
                            <a href="../../Misc/changelog">Changelog</a>
                        </li>
                    
                        <li >
                            <a href="../../Misc/koa-vs-express">Koa vs Express</a>
                        </li>
                    
                        <li >
                            <a href="../../Misc/faq">Faq</a>
                        </li>
                    
                        <li >
                            <a href="../../Misc/whousekoa">WhoUse</a>
                        </li>
                    
                        <li >
                            <a href="../../Misc/utilities">Utilities</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../about">About</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../application">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../request">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#context">Context</a></li>
        
            <li><a href="#api">API</a></li>
        
            <li><a href="#request-aliases">Request aliases</a></li>
        
            <li><a href="#response-aliases">Response aliases</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="context">Context</h1>
<p>A Koa Context encapsulates node's <code>request</code> and <code>response</code> objects
  into a single object which provides many helpful methods for writing
  web applications and APIs.
  These operations are used so frequently in HTTP server development
  that they are added at this level instead of a higher level framework,
  which would force middleware to re-implement this common functionality.</p>
<p>A <code>Context</code> is created <em>per</em> request, and is referenced in middleware
  as the receiver, or the <code>this</code> identifier, as shown in the following
  snippet:</p>
<pre><code class="js">app.use(function *(){
  this; // is the Context
  this.request; // is a koa Request
  this.response; // is a koa Response
});
</code></pre>

<p>Many of the context's accessors and methods simply delegate to their <code>ctx.request</code> or <code>ctx.response</code>
  equivalents for convenience, and are otherwise identical. For example <code>ctx.type</code> and <code>ctx.length</code>
  delegate to the <code>response</code> object, and <code>ctx.path</code> and <code>ctx.method</code> delegate to the <code>request</code>.</p>
<h2 id="api">API</h2>
<p><code>Context</code> specific methods and accessors.</p>
<h3 id="ctxreq">ctx.req</h3>
<p>Node's <code>request</code> object.</p>
<h3 id="ctxres">ctx.res</h3>
<p>Node's <code>response</code> object.</p>
<p>Bypassing Koa's response handling is <strong>not supported</strong>. Avoid using the following node properties:</p>
<ul>
<li><code>res.statusCode</code></li>
<li><code>res.writeHead()</code></li>
<li><code>res.write()</code></li>
<li><code>res.end()</code></li>
</ul>
<h3 id="ctxrequest">ctx.request</h3>
<p>A koa <code>Request</code> object.</p>
<h3 id="ctxresponse">ctx.response</h3>
<p>A koa <code>Response</code> object.</p>
<h3 id="ctxstate">ctx.state</h3>
<p>The recommended namespace for passing information through middleware and to your frontend views.</p>
<pre><code class="js">this.state.user = yield User.find(id);
</code></pre>

<h3 id="ctxapp">ctx.app</h3>
<p>Application instance reference.</p>
<h3 id="ctxcookiesgetname-options">ctx.cookies.get(name, [options])</h3>
<p>Get cookie <code>name</code> with <code>options</code>:</p>
<ul>
<li><code>signed</code> the cookie requested should be signed</li>
</ul>
<p>koa uses the <a href="https://github.com/jed/cookies">cookies</a> module where options are simply passed.</p>
<h3 id="ctxcookiessetname-value-options">ctx.cookies.set(name, value, [options])</h3>
<p>Set cookie <code>name</code> to <code>value</code> with <code>options</code>:</p>
<ul>
<li><code>signed</code> sign the cookie value</li>
<li><code>expires</code> a <code>Date</code> for cookie expiration</li>
<li><code>path</code> cookie path, <code>/'</code> by default</li>
<li><code>domain</code> cookie domain</li>
<li><code>secure</code> secure cookie</li>
<li><code>httpOnly</code> server-accessible cookie, <strong>true</strong> by default</li>
</ul>
<p>koa uses the <a href="https://github.com/jed/cookies">cookies</a> module where options are simply passed.</p>
<h3 id="ctxthrowmsg-status-properties">ctx.throw([msg], [status], [properties])</h3>
<p>Helper method to throw an error with a <code>.status</code> property
  defaulting to <code>500</code> that will allow Koa to respond appropriately.
  The following combinations are allowed:</p>
<pre><code class="js">this.throw(403);
this.throw('name required', 400);
this.throw(400, 'name required');
this.throw('something exploded');
</code></pre>

<p>For example <code>this.throw('name required', 400)</code> is equivalent to:</p>
<pre><code class="js">var err = new Error('name required');
err.status = 400;
throw err;
</code></pre>

<p>Note that these are user-level errors and are flagged with
  <code>err.expose</code> meaning the messages are appropriate for
  client responses, which is typically not the case for
  error messages since you do not want to leak failure
  details.</p>
<p>You may optionally pass a <code>properties</code> object which is merged into the error as-is, useful for decorating machine-friendly errors which are reported to the requester upstream.</p>
<pre><code class="js">this.throw(401, 'access_denied', { user: user });
this.throw('access_denied', { user: user });
</code></pre>

<p>koa uses <a href="https://github.com/jshttp/http-errors">http-errors</a> to create errors.</p>
<h3 id="ctxassertvalue-msg-status-properties">ctx.assert(value, [msg], [status], [properties])</h3>
<p>Helper method to throw an error similar to <code>.throw()</code>
  when <code>!value</code>. Similar to node's <a href="http://nodejs.org/api/assert.html">assert()</a>
  method.</p>
<pre><code class="js">this.assert(this.user, 401, 'User not found. Please login!');
</code></pre>

<p>koa uses <a href="https://github.com/jshttp/http-assert">http-assert</a> for assertions.</p>
<h3 id="ctxrespond">ctx.respond</h3>
<p>To bypass Koa's built-in response handling, you may explicitly set <code>this.respond = false;</code>. Use this if you want to write to the raw <code>res</code> object instead of letting Koa handle the response for you.</p>
<p>Note that using this is <strong>not</strong> supported by Koa. This may break intended functionality of Koa middleware and Koa itself. Using this property is considered a hack and is only a convenience to those wishing to use traditional <code>fn(req, res)</code> functions and middleware within Koa.</p>
<h2 id="request-aliases">Request aliases</h2>
<p>The following accessors and alias <a href="../request">Request</a> equivalents:</p>
<ul>
<li><code>ctx.header</code></li>
<li><code>ctx.headers</code></li>
<li><code>ctx.method</code></li>
<li><code>ctx.method=</code></li>
<li><code>ctx.url</code></li>
<li><code>ctx.url=</code></li>
<li><code>ctx.originalUrl</code></li>
<li><code>ctx.href</code></li>
<li><code>ctx.path</code></li>
<li><code>ctx.path=</code></li>
<li><code>ctx.query</code></li>
<li><code>ctx.query=</code></li>
<li><code>ctx.querystring</code></li>
<li><code>ctx.querystring=</code></li>
<li><code>ctx.host</code></li>
<li><code>ctx.hostname</code></li>
<li><code>ctx.fresh</code></li>
<li><code>ctx.stale</code></li>
<li><code>ctx.socket</code></li>
<li><code>ctx.protocol</code></li>
<li><code>ctx.secure</code></li>
<li><code>ctx.ip</code></li>
<li><code>ctx.ips</code></li>
<li><code>ctx.subdomains</code></li>
<li><code>ctx.is()</code></li>
<li><code>ctx.accepts()</code></li>
<li><code>ctx.acceptsEncodings()</code></li>
<li><code>ctx.acceptsCharsets()</code></li>
<li><code>ctx.acceptsLanguages()</code></li>
<li><code>ctx.get()</code></li>
</ul>
<h2 id="response-aliases">Response aliases</h2>
<p>The following accessors and alias <a href="../response">Response</a> equivalents:</p>
<ul>
<li><code>ctx.body</code></li>
<li><code>ctx.body=</code></li>
<li><code>ctx.status</code></li>
<li><code>ctx.status=</code></li>
<li><code>ctx.message</code></li>
<li><code>ctx.message=</code></li>
<li><code>ctx.length=</code></li>
<li><code>ctx.length</code></li>
<li><code>ctx.type=</code></li>
<li><code>ctx.type</code></li>
<li><code>ctx.headerSent</code></li>
<li><code>ctx.redirect()</code></li>
<li><code>ctx.attachment()</code></li>
<li><code>ctx.set()</code></li>
<li><code>ctx.append()</code></li>
<li><code>ctx.remove()</code></li>
<li><code>ctx.lastModified=</code></li>
<li><code>ctx.etag=</code></li>
</ul>
</div>
        </div>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>